
<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Divya Jap Mala</title>
    <style>
        :root {
            --saffron: #FF9933;
            --saffron-dark: #cc7a29;
            --cream: #FFF5E1;
            --rudraksha: #5D2E17;
            --text: #4a2c2a;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--cream);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        header {
            width: 100%;
            padding: 15px;
            text-align: center;
            background-color: var(--saffron);
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 20px;
            letter-spacing: 1px;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            position: relative;
        }

        /* Adjusted side circles to be further apart at the edges */
        .deity-container {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            height: 80px;
            background: white;
            border: 4px solid var(--saffron);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 5;
            font-size: 16px;
            color: var(--saffron-dark);
            font-weight: bold;
            text-align: center;
            padding: 5px;
            line-height: 1.2;
        }
        .deity-left { left: -10px; } /* Moved outside slightly for extreme edge feel */
        .deity-right { right: -10px; }

        .mantra-display {
            font-size: 30px;
            font-weight: bold;
            color: var(--saffron-dark);
            height: 60px;
            display: flex;
            align-items: center;
            text-align: center;
            margin-top: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            z-index: 6;
        }

        .counter-box {
            background: white;
            padding: 8px 30px;
            border-radius: 50px;
            border: 2px solid var(--saffron);
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 6;
        }

        .mala-button-container {
            position: relative;
            width: 220px;
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mala-btn {
            width: 170px;
            height: 170px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #8b4513, #5d2e17);
            border: 8px solid #3d1e0f;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4), inset 0 0 20px rgba(0,0,0,0.6);
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .mala-btn:active { transform: scale(0.94); }
        .mala-btn:disabled { filter: grayscale(0.8); cursor: default; }

        .beads-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px dashed var(--saffron);
            border-radius: 50%;
            animation: rotate 80s linear infinite;
            opacity: 0.6;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .controls {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            margin-bottom: 25px;
            z-index: 6;
        }

        .mantra-selector {
            width: 85%;
            padding: 12px;
            font-size: 18px;
            border-radius: 12px;
            border: 2px solid var(--saffron);
            background: white;
            color: var(--text);
            outline: none;
            font-weight: bold;
        }

        .reset-btn {
            padding: 12px 40px;
            font-size: 18px;
            background-color: var(--saffron);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .completion-msg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 25px;
            border: 5px solid var(--saffron);
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 0 60px rgba(0,0,0,0.4);
            display: none;
            z-index: 100;
            width: 85%;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none; z-index: 99;
        }

        .decor { font-size: 24px; color: var(--saffron); margin: 8px 0; }

        .toggle-row {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }

        .voice-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--saffron-dark);
            font-weight: bold;
        }

        @media (max-width: 420px) {
            .deity-container {
                width: 65px;
                height: 65px;
                font-size: 12px;
            }
            .deity-left { left: 5px; }
            .deity-right { right: 5px; }
            .mantra-display { font-size: 24px; }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>

    <header>
        <h1>‡§¶‡§ø‡§µ‡•ç‡§Ø ‡§ú‡§™ ‡§Æ‡§æ‡§≤‡§æ</h1>
    </header>

    <div class="container">
        <!-- Side Circles moved further apart -->
        <div class="deity-container deity-left" id="sideIconLeft">‡§∞‡§æ‡§Æ ‡§∞‡§æ‡§Æ</div>
        <div class="deity-container deity-right" id="sideIconRight">‡§∞‡§æ‡§Æ ‡§∞‡§æ‡§Æ</div>

        <div class="mantra-display" id="mantraDisplay">‡§∞‡§æ‡§Æ ‡§∞‡§æ‡§Æ</div>
        
        <div class="counter-box">
            ‡§ú‡§™: <span id="counter">0</span> / 108
        </div>

        <div class="mala-button-container">
            <div class="beads-circle"></div>
            <button class="mala-btn" id="tapBtn" aria-label="‡§ú‡§™ ‡§ï‡§∞‡•á‡§Ç"></button>
        </div>

        <div class="controls">
            <select class="mantra-selector" id="mantraSelector">
                <option value="‡§∞‡§æ‡§Æ ‡§∞‡§æ‡§Æ">‡§∞‡§æ‡§Æ ‡§∞‡§æ‡§Æ</option>
                <option value="‡§∞‡§æ‡§ß‡•á ‡§∞‡§æ‡§ß‡•á">‡§∞‡§æ‡§ß‡•á ‡§∞‡§æ‡§ß‡•á</option>
                <option value="‡§ï‡•É‡§∑‡•ç‡§£ ‡§ï‡•É‡§∑‡•ç‡§£">‡§ï‡•É‡§∑‡•ç‡§£ ‡§ï‡•É‡§∑‡•ç‡§£</option>
                <option value="‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø">‡•ê ‡§®‡§Æ‡§É ‡§∂‡§ø‡§µ‡§æ‡§Ø</option>
                <option value="‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§£‡•á‡§∂‡§æ‡§Ø ‡§®‡§Æ‡§É">‡§∂‡•ç‡§∞‡•Ä ‡§ó‡§£‡•á‡§∂‡§æ‡§Ø ‡§®‡§Æ‡§É</option>
                <option value="‡§ú‡§Ø ‡§π‡§®‡•Å‡§Æ‡§æ‡§®">‡§ú‡§Ø ‡§π‡§®‡•Å‡§Æ‡§æ‡§®</option>
                <option value="‡•ê ‡§π‡§Ç ‡§π‡§®‡•Å‡§Æ‡§§‡•á ‡§®‡§Æ‡§É">‡•ê ‡§π‡§Ç ‡§π‡§®‡•Å‡§Æ‡§§‡•á ‡§®‡§Æ‡§É</option>
            </select>
            
            <div class="toggle-row">
                <div class="voice-toggle">
                    <input type="checkbox" id="voiceToggle" checked>
                    <label for="voiceToggle">‡§Æ‡§π‡§ø‡§≤‡§æ ‡§∏‡•ç‡§µ‡§∞</label>
                </div>
                <div class="voice-toggle">
                    <input type="checkbox" id="musicToggle" checked>
                    <label for="musicToggle">‡§≠‡§ï‡•ç‡§§‡§ø ‡§∏‡§Ç‡§ó‡•Ä‡§§</label>
                </div>
            </div>

            <button class="reset-btn" id="resetBtn">‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="completion-msg" id="completionMsg">
        <div class="decor">‚úø ‚úø ‚úø</div>
        üôè 108 ‡§ú‡§™ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§è üôè
        <div class="decor">‚úø ‚úø ‚úø</div>
        <br>
        <button class="reset-btn" onclick="resetCount()">‡§†‡•Ä‡§ï ‡§π‡•à</button>
    </div>

    <script>
        let count = 0;
        const maxLimit = 108;
        let audioCtx = null;
        let mainGain = null;
        let oscillators = [];
        let melodyTimeout = null;

        const counterEl = document.getElementById('counter');
        const tapBtn = document.getElementById('tapBtn');
        const resetBtn = document.getElementById('resetBtn');
        const mantraSelector = document.getElementById('mantraSelector');
        const mantraDisplay = document.getElementById('mantraDisplay');
        const sideIconLeft = document.getElementById('sideIconLeft');
        const sideIconRight = document.getElementById('sideIconRight');
        const completionMsg = document.getElementById('completionMsg');
        const overlay = document.getElementById('overlay');
        const voiceToggle = document.getElementById('voiceToggle');
        const musicToggle = document.getElementById('musicToggle');

        function playMelody() {
            if (!mainGain || !musicToggle.checked) return;
            
            const notes = [329.63, 392.00, 440.00, 523.25, 587.33, 659.25]; 
            const randomNote = notes[Math.floor(Math.random() * notes.length)];
            
            const osc = audioCtx.createOscillator();
            const noteGain = audioCtx.createGain();
            
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(randomNote, audioCtx.currentTime);
            
            noteGain.gain.setValueAtTime(0, audioCtx.currentTime);
            noteGain.gain.linearRampToValueAtTime(0.04, audioCtx.currentTime + 0.8);
            noteGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 3);
            
            osc.connect(noteGain);
            noteGain.connect(mainGain);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
            
            melodyTimeout = setTimeout(playMelody, 1500 + Math.random() * 2500);
        }

        function startMusic() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (oscillators.length > 0) return;

            mainGain = audioCtx.createGain();
            mainGain.gain.setValueAtTime(0, audioCtx.currentTime);
            mainGain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 2);
            mainGain.connect(audioCtx.destination);

            const baseFreqs = [128, 192, 96]; 
            baseFreqs.forEach(f => {
                const osc = audioCtx.createOscillator();
                const lGain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(f, audioCtx.currentTime);
                lGain.gain.setValueAtTime(0.15, audioCtx.currentTime);
                osc.connect(lGain);
                lGain.connect(mainGain);
                osc.start();
                oscillators.push(osc);
            });

            playMelody();
        }

        function stopMusic() {
            if (mainGain) {
                mainGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 1);
                clearTimeout(melodyTimeout);
                setTimeout(() => {
                    oscillators.forEach(o => o.stop());
                    oscillators = [];
                }, 1100);
            }
        }

        musicToggle.addEventListener('change', () => {
            if (musicToggle.checked) {
                if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
                startMusic();
            } else {
                stopMusic();
            }
        });

        let femaleVoice = null;
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            femaleVoice = voices.find(v => v.lang.includes('hi') && (v.name.toLowerCase().includes('female') || v.name.toLowerCase().includes('google'))) 
                        || voices.find(v => v.lang.includes('hi'))
                        || voices.find(v => v.name.toLowerCase().includes('female'));
        }
        window.speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();

        function speak(text) {
            if (!voiceToggle.checked) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'hi-IN';
            if (femaleVoice) utterance.voice = femaleVoice;
            utterance.pitch = 1.1;
            utterance.rate = 1;
            window.speechSynthesis.speak(utterance);
        }

        function updateDisplay() {
            counterEl.innerText = count;
            if (count >= maxLimit) {
                tapBtn.disabled = true;
                completionMsg.style.display = 'block';
                overlay.style.display = 'block';
                speak("‡§è‡§ï ‡§∏‡•å ‡§Ü‡§† ‡§ú‡§™ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§è‡•§ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§");
            } else {
                tapBtn.disabled = false;
                completionMsg.style.display = 'none';
                overlay.style.display = 'none';
                if (count > 0) speak(mantraSelector.value);
            }
        }

        function resetCount() {
            count = 0;
            updateDisplay();
        }

        tapBtn.addEventListener('click', () => {
            if (musicToggle.checked) {
                if (!audioCtx) startMusic();
                else if (audioCtx.state === 'suspended') audioCtx.resume();
            }

            if (count < maxLimit) {
                count++;
                updateDisplay();
                tapBtn.style.transform = 'scale(0.92)';
                setTimeout(() => tapBtn.style.transform = 'scale(1)', 100);
            }
        });

        resetBtn.addEventListener('click', resetCount);

        mantraSelector.addEventListener('change', (e) => {
            const val = e.target.value;
            mantraDisplay.innerText = val;
            sideIconLeft.innerText = val;
            sideIconRight.innerText = val;
        });
    </script>
</body>
</html>
